generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User authentication
model User {
  id            String   @id @default(cuid())
  username      String   @unique
  password      String
  name          String
  nip           String?  // NIP or NIPTK
  role          String   @default("guru") // admin, guru, kepsek, pengawas, guru_mapel
  kelas         Int?     // 1-6, null for admin/kepsek/pengawas/guru_mapel
  mapelDiampu   String?  // For guru_mapel: comma-separated subjects (e.g., "AKPK" or "PAI")
  fotoProfilUrl String?  // Profile photo URL
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// School settings
model SchoolSettings {
  id            String  @id @default("main")
  namaSekolah   String  @default("SDN 2 Nangerang")
  kepalaSekolah String?
  nipKepsek     String?
  tahunAjaran   String  @default("2025/2026")
}

// Wali kelas per class
model WaliKelas {
  kelas Int     @id // 1-6
  nama  String
  nip   String?
}

// Student data
model Siswa {
  id           String    @id @default(cuid())
  nis          String    @unique
  nama         String
  jenisKelamin String
  kelas        Int
  alamat       String?
  namaOrtu     String?
  noHp         String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  absensi      Absensi[]
  nilai        Nilai[]
}

// Daily attendance
model Absensi {
  id      String   @id @default(cuid())
  siswaId String
  siswa   Siswa    @relation(fields: [siswaId], references: [id], onDelete: Cascade)
  tanggal DateTime @db.Date
  status  String   // H, S, I, A

  @@unique([siswaId, tanggal])
  @@index([tanggal])
}

// Grades
model Nilai {
  id         String @id @default(cuid())
  siswaId    String
  siswa      Siswa  @relation(fields: [siswaId], references: [id], onDelete: Cascade)
  mapel      String
  jenisNilai String // UH1, UH2, UH3, UTS, UAS
  nilai      Float

  @@unique([siswaId, mapel, jenisNilai])
}

// Daily journal
model Jurnal {
  id         String   @id @default(cuid())
  kelas      Int
  tanggal    DateTime @db.Date
  jamKe      String
  mapel      String
  materi     String
  metode     String
  catatan    String?
  siswaAbsen String?
  createdAt  DateTime @default(now())

  @@index([kelas, tanggal])
}

// Custom mapel names per class (overrides default config)
model MapelKelas {
  id        String @id @default(cuid())
  kelas     Int
  mapelCode String // Internal code (e.g., "B.Inggris")
  namaMapel String // Display name that can be edited

  @@unique([kelas, mapelCode])
  @@index([kelas])
}

// Teacher daily attendance
model AbsensiGuru {
  id           String   @id @default(cuid())
  userId       String
  tanggal      DateTime @db.Date
  waktuDatang  String?  // HH:MM format
  ttdDatang    String?  @db.Text // Base64 signature image
  waktuPulang  String?  // HH:MM format  
  ttdPulang    String?  @db.Text // Base64 signature image
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([userId, tanggal])
  @@index([tanggal])
}

// Buku perpustakaan
model Buku {
  id          String   @id @default(cuid())
  judul       String
  penulis     String
  penerbit    String?
  tahunTerbit Int?
  isbn        String?
  kategori    String   // Fiksi, Non-Fiksi, Pelajaran, Referensi, Majalah
  kelas       Int?     // 1-6 untuk buku pelajaran SD
  jumlahCopy  Int      @default(1)
  lokasi      String?  // Rak/Lokasi buku
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Aset sekolah - Kartu Inventaris Barang (KIB)
model Aset {
  id               String    @id @default(cuid())
  namaAset         String
  kib              String    // A=Tanah, B=Peralatan/Mesin, C=Gedung, D=Jalan/Jaringan, E=Aset Lainnya
  kategori         String    // Sub-kategori: Perabot, Elektronik, Alat Olahraga, dll
  jumlah           Int       @default(1)
  kondisi          String    // Baik, Rusak Ringan, Rusak Berat
  lokasi           String?   // Ruang/lokasi penyimpanan
  tahunPerolehan   Int       // Tahun barang diperoleh
  sumberDana       String    // BOS Reguler, BOS Kinerja, Hibah Pemda, Komite
  hargaPerolehan   Float     // Harga beli awal (untuk ARKAS/SIPD)
  nilaiPerUnit     Float?    // Nilai per unit saat ini (opsional)
  buktiKepemilikan String?   // No. sertifikat/faktur/nota
  tanggalBeli      DateTime? @db.Date
  keterangan       String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}
